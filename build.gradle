apply plugin: 'java'

defaultTasks 'clean', 'assemble'

sourceCompatibility = 1.7
version = '1.0.0'

buildDir = "out"

ext {
  releaseDir = "release"
}

repositories {
  mavenCentral()
}

dependencies {
  compile 'com.google.guava:guava:14.0.1'
  testCompile 'junit:junit:4.11'
}

clean.doLast {
  ant.delete(dir: releaseDir)
}

task release(dependsOn: 'assemble') << {
  out.println "Releasing $version"
}

gradle.taskGraph.whenReady {taskGraph ->
  if (!taskGraph.hasTask(release)) {
    version += "-SNAPSHOT"
  }
}

jar {
  destinationDir = file(releaseDir)
  manifest {
    attributes 'Manifest-Version': version, 'Main-Class': 'com.selesse.tailerswift.Main'
  }

  from configurations.compile.collect { it.isDirectory() ? it : zipTree(it) }
}

task getVersion << {
  out.println version
}
